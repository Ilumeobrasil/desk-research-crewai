plan_research_task:
  description: >
    Receba o tema de negócio: '{topic}' e elabore um PLANO DE PESQUISA ESTRATÉGICO
    para o X (Twitter), com foco em revelar percepções relevantes do consumidor,
    riscos reputacionais e sinais de oportunidade para a marca.

    CONTEXTO:
    Este plano será usado para orientar análises que apoiam decisões de marketing
    e insights de negócio. Priorize relevância estratégica em vez de volume.

    INSTRUÇÕES:
    - Liste palavras-chave principais diretamente relacionadas ao tema.
    - Inclua variações semânticas e termos usados espontaneamente por consumidores.
    - Sugira hashtags apenas se forem relevantes e usadas de forma orgânica.
    - Defina janelas de tempo e filtros de engajamento coerentes com o tema.
    - Evite termos genéricos que gerem ruído irrelevante.
  expected_output: >
    Retorne APENAS um JSON válido com as chaves:
    - queries: array de strings (priorizando precisão sobre quantidade)
    - hashtags: array de strings (pode ser vazio [])
    - days_window_sugerido: inteiro
    - min_engagement_sugerido: inteiro

collect_tweets_task:
  description: >
    Usando o research_plan gerado anteriormente, chame a ferramenta 
    twitter_search_tool para cada query/hashtag.
    - Respeite, sempre que fizer sentido, os valores de days_window_sugerido 
    e min_engagement_sugerido.
    - Consolide todos os tweets em uma lista única JSON, sem duplicar IDs.
    - Não invente dados; use apenas o retorno da ferramenta.
  expected_output: "Lista JSON de tweets padronizados."


analyze_insights_task:
  description: >
    **REGRA CRÍTICA - VALIDAÇÃO DE DADOS**:
    ANTES de qualquer análise, você DEVE verificar se tweets_raw contém dados reais.
    
    **SE tweets_raw estiver VAZIO ([]), NULL, ou contiver MENOS de 3 tweets válidos**:
    - Retorne APENAS este JSON:
    {{
      "insufficient_data": true,
      "message": "Não foram encontradas informações suficientes no X (Twitter) para realizar a análise. Possíveis causas: ausência de conversas sobre o tema no período pesquisado, ou filtros muito restritivos.",
      "themes": [],
      "tribes": [],
      "overall_sentiment": {{"positive": 0, "neutral": 0, "negative": 0}},
      "key_trends": [],
      "risks": [],
      "opportunities": []
    }}
    - NÃO invente temas, sentimentos, tribos ou tendências.
    - NÃO use dados de exemplo ou genéricos.
    
    **SE tweets_raw contiver dados suficientes (>= 3 tweets válidos)**:
    A partir de tweets_raw, produza um JSON de insights estruturado com o formato:
    {{
      "insufficient_data": false,
      "themes": [
        {{
          "name": "Tema X",
          "volume_percent": 35,
          "sentiment": {{"positive": 40, "neutral": 30, "negative": 30}},
          "main_ideas": ["...", "..."],
          "example_tweets_ids": ["123", "456"]
        }}
      ],
      "tribes": [
         {{"name": "Early Adopters", "stance": "Apoiam X", "sentiment": 80}},
         {{"name": "Críticos/Haters", "stance": "Reclamam de Y", "sentiment": 20}}
      ],
      "overall_sentiment": {{"positive": 40, "neutral": 35, "negative": 25}},
      "key_trends": ["tendência 1", "tendência 2"],
      "risks": ["risco 1", "risco 2"],
      "opportunities": ["oportunidade 1", "oportunidade 2"]
    }}
    
    **REGRAS OBRIGATÓRIAS**:
    1. Use APENAS os dados reais de tweets_raw. NUNCA invente tweets, IDs, ou métricas.
    2. Se um tema não aparecer claramente nos tweets, NÃO o inclua.
    3. Todos os example_tweets_ids devem ser IDs REAIS que existem em tweets_raw.
    4. Percentuais devem ser calculados baseados nos tweets reais, não estimados.
    5. Se não houver dados suficientes para uma categoria (ex: tribes), deixe o array vazio [].
  expected_output: >
    JSON de insights sobre o tema com análise de tribos.
    Se não houver dados suficientes, retorne o JSON com insufficient_data: true e mensagem explicativa.

write_report_task:
  description: >
    A partir de insights_json, escreva um RELATÓRIO EXECUTIVO em Markdown 
    sobre o tema: {topic}.

    DATA DO RELATÓRIO: {date}

    **REGRAS DE FORMATAÇÃO**:
    **REGRAS DE CONTEÚDO (DIDÁTICO & ESPECÍFICO)**:
    1. **Conexão Direta**: Todo insight deve responder à pergunta principal: '{topic}'. Evite temas genéricos como 'Flavor Preferences' se não houver dados reais disso. Use os dados que você tem.
    2. **Explique o 'Porquê'**: Não diga apenas '40% positivo'. Ex: '40% positivo PORQUE os usuários citam o sabor da nova cerveja sem álcool'. Seja didático.
    3. **Análise de Sentimento Explicada**: Detalhe as emoções por trás dos números. O que causa a raiva? O que causa a alegria?

    Estrutura:
    1. Resumo Executivo (Respondendo à pergunta '{topic}')
    2. Metodologia
    3. Principais Temas Identificados (Com explicações profundas)
    4. Análise de Tribos/Grupos de Opinião (Quem fala o quê?)
    5. Análise de Sentimento Detalhada (O 'Porquê' dos sentimentos)
    6. Tendências e Sinais de Mercado
    7. Riscos e Oportunidades
    8. Exemplos Representativos de Conversas
    9. Recomendações Iniciais para Marketing/Insights
  expected_output: "Relatório em Markdown limpo (sem blocos de código), com data e título."
