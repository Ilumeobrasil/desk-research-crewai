ingest:
  description: >
    Leia os arquivos .docx em {ingest_input_dir} (recursivo), extraia o texto integral e escreva
    arquivos .json em {ingest_output_dir}. Use a ferramenta ingest_folder_tool com:

    - input_dir: {ingest_input_dir}
    - output_dir: {ingest_output_dir}
    - upload_to_asimov: {upload_to_asimov} (DEVE ser true)
    - snippet_chunk_chars: {snippet_chunk_chars}
    - max_snippets_per_request: {max_snippets_per_request}

    Retorne um resumo com contagem de arquivos processados e avisos.
  expected_output: >
    Um resumo textual contendo:
    - input_dir e output_dir efetivos
    - quantidade de docx lidos
    - quantidade de json escritos
    - status do upload Asimov (ok/erro, contagem, dataset)
    - lista curta de avisos (se houver)
  agent: ingestor

treat:
  description: >
    Execute o Agente 2 (Treatment) sobre os JSONs gerados pelo Agente 1 (ingestor).

    Leia os arquivos .json em {treat_input_dir} (onde o ingestor escreveu os JSONs) 
    e escreva a saída tratada em {treat_output_dir}. Use a ferramenta treat_folder com:

    - input_dir: {treat_input_dir}
    - output_dir: {treat_output_dir}
    - enable_rag: {enable_rag} (DEVE ser true)
    - poll_attempts: {poll_attempts}
    - poll_sleep_s: {poll_sleep_s}
    - temperature: {temperature}
    - max_tokens: {max_tokens}

    ─────────────────────────────────────────
    LIMPEZA E NORMALIZAÇÃO DO TEXTO
    ─────────────────────────────────────────

    O texto extraído dos documentos pode conter artefatos e ruído. Você DEVE aplicar
    uma limpeza rigorosa antes de processar:

    1. **Remoção de Artefatos de Formatação**:
       - Remover caracteres de controle invisíveis (tabs, quebras de linha excessivas)
       - Normalizar espaços múltiplos para espaço único
       - Remover formatação markdown residual (**texto**, *texto*, `código`)
       - Normalizar aspas inteligentes (" " → " ")
       - Normalizar traços especiais (- — → -)
       - Remover caracteres especiais quebrados (�, ? em sequências)

    2. **Remoção de Conteúdo Não-Informativo**:
       - Remover cabeçalhos e rodapés repetitivos de documentos
       - Remover metadados de arquivo (nomes de arquivo, caminhos, timestamps)
       - Remover instruções de formatação ou templates visíveis
       - Remover linhas vazias excessivas (manter no máximo 2 linhas consecutivas)
       - Remover pontuação repetida excessiva (!!! → !, ??? → ?)

    3. **Normalização de Estrutura**:
       - Manter apenas o conteúdo textual relevante das entrevistas
       - Preservar diálogos e falas dos entrevistados
       - Remover identificadores técnicos ou códigos internos quando não informativos
       - Normalizar variações de escrita (ex.: "não" vs "não" com acento)

    4. **Foco em Pontos Importantes**:
       - Priorizar declarações diretas dos consumidores sobre comportamentos, opiniões e sentimentos
       - Manter contexto suficiente para entender o significado das falas
       - Remover redundâncias e repetições desnecessárias
       - Preservar evidências literais que sustentam insights

    ─────────────────────────────────────────
    EXTRAÇÃO DE SEMÂNTICA VIA RAG
    ─────────────────────────────────────────

    Após a limpeza, consulte o Asimov RAG para extrair semântica estruturada:

    - **language**: Identifique o idioma do texto (código ISO, ex.: "pt")
    - **brand_mentions**: Liste marcas mencionadas explicitamente (normalizadas, sem duplicatas)
    - **themes**: Extraia temas principais discutidos (focos em insights de consumo, comportamentos, preferências)
    - **sentiments**: Identifique sentimentos expressos (positivo, neutro, negativo, ambivalente)
    - **moments**: Capture momentos/ocasiões de consumo mencionados
    - **evidence**: Selecione 2-5 evidências literais mais relevantes do texto limpo que sustentam os temas identificados

    ⚠️ IMPORTANTE: As evidências devem ser trechos EXATOS do texto limpo, não paráfrases.
    Priorize evidências que sejam:
    - Declarações diretas dos consumidores
    - Exemplos concretos de comportamento ou opinião
    - Citações que ilustram sentimentos ou temas identificados

  expected_output: >
    Após processar os arquivos com a ferramenta treat_folder, você DEVE fornecer um resumo
    estruturado que será usado pela task write_report. O resumo DEVE incluir:
    
    1. Resumo estatístico do processamento (já fornecido pela ferramenta):
       - Número de arquivos processados
       - Número de arquivos com sucesso/erro
       - Status do RAG
    
    2. Resumo dos dados tratados (CRÍTICO para o relatório):
       Após a ferramenta treat_folder processar os arquivos, você DEVE ler os arquivos JSON tratados
       no diretório {treat_output_dir} e consolidar os seguintes dados:
       
       - Lista de TODAS as marcas mencionadas com seus NOMES REAIS (ex: Brahma, Heineken, Skol, Stella Artois)
         e quantas entrevistas mencionaram cada marca
       
       - Lista de TODOS os temas identificados e quantas entrevistas mencionaram cada tema
       
       - Lista de TODOS os sentimentos encontrados e sua distribuição
       
       - Lista de TODOS os momentos de consumo mencionados
       
       - Lista das evidências mais importantes (citações literais do campo "evidence")
         organizadas por tema ou marca quando aplicável
       
       - Número total de entrevistas processadas com sucesso
       
       FORMATO DO RESUMO:
       Apresente os dados consolidados de forma estruturada, listando explicitamente:
       - Nomes reais das marcas (nunca use genéricos)
       - Citações literais exatas do campo "evidence"
       - Contagens de menções por tema/marca/sentimento
       
       IMPORTANTE: O resumo dos dados tratados é essencial porque será a única fonte de informação
       disponível para a task write_report. Sem esse resumo detalhado com nomes reais de marcas
       e citações literais, o relatório não poderá ser gerado corretamente.
  agent: treater

write_report:
  description: >
    ⚠️ RELATÓRIO COM RESTRIÇÃO ABSOLUTA AO CONTEXTO ⚠️

    Este agente DEVE operar em modo "context-bound".
    É PROIBIDO usar qualquer conhecimento externo, inferência lógica,
    generalização de mercado ou preenchimento de lacunas.

    O relatório deve ser construído EXCLUSIVAMENTE a partir do conteúdo
    explicitamente presente no contexto fornecido pelo treatment_result.
    
    O treatment_result contém um resumo do processamento E os dados tratados das entrevistas.
    Os dados tratados incluem:
    - Transcrições limpas das entrevistas (cleaned_text)
    - Marcas mencionadas pelos entrevistados (brand_mentions) - use os NOMES REAIS das marcas
    - Temas identificados (themes)
    - Sentimentos expressos (sentiments)
    - Momentos de consumo (moments)
    - Evidências literais (evidence) - citações EXATAS dos entrevistados
    
    ⚠️ CRÍTICO: Você DEVE usar APENAS os dados reais presentes no treatment_result.
    NUNCA invente ou use nomes genéricos como "Marca A" ou "Marca B".
    SEMPRE use os nomes reais das marcas mencionadas nas entrevistas (ex: Brahma, Heineken, Skol, Stella Artois).
    SEMPRE use as citações literais exatas dos entrevistados presentes no campo "evidence".

    ─────────────────────────────────────────
    MODO DE OPERAÇÃO OBRIGATÓRIO (NÃO IGNORAR)
    ─────────────────────────────────────────

    Antes de escrever qualquer seção do relatório, siga este processo:

    1. VERIFICAÇÃO:
       - Verifique se o tema existe explicitamente nos dados das entrevistas.
       - Se NÃO existir, a seção NÃO deve conter análise.
       - Declare explicitamente: 
         "Este tema não foi mencionado nas entrevistas analisadas."

    2. VALIDAÇÃO:
       - Para cada afirmação, localize:
         a) Quantidade de entrevistas que mencionam o ponto
         b) Citação literal exata que comprova a afirmação
       - Se qualquer um dos dois não existir, a afirmação NÃO pode ser escrita.

    3. BLOQUEIO DE INFERÊNCIA:
       - NÃO interprete causas, motivações ou impactos
         se eles não forem verbalizados pelos entrevistados.
       - NÃO conecte temas entre si sem fala explícita dos consumidores
         que estabeleça essa conexão.

    ─────────────────────────────────────────
    OBJETIVO DO RELATÓRIO
    ─────────────────────────────────────────

    Com base apenas nas entrevistas Consumer Hours processadas,
    escreva um RELATÓRIO EXECUTIVO em Markdown sobre o tema:

    "{topic}"

    Data do relatório: {date}

    O relatório é destinado à área de Insights e deve usar
    linguagem de negócio, clara e objetiva, sem termos técnicos.

    ─────────────────────────────────────────
    FONTE DE DADOS DISPONÍVEL
    ─────────────────────────────────────────

    O treatment_result contém informações sobre o processamento das entrevistas.
    Os dados tratados estão disponíveis nos arquivos JSON no diretório {treat_output_dir}.
    
    IMPORTANTE: O treatment_result pode conter apenas um resumo estatístico. 
    Você DEVE processar o conteúdo das entrevistas que está disponível no contexto
    da task anterior (treat) ou nos arquivos JSON mencionados no treatment_result.

    Você tem acesso a:
    - Transcrições literais das entrevistas (cleaned_text nos arquivos tratados)
    - Temas identificados (campo "themes" na semântica de cada arquivo)
    - Análises de sentimento extraídas das falas (campo "sentiments")
    - Marcas mencionadas explicitamente (campo "brand_mentions")
    - Momentos de consumo citados pelos entrevistados (campo "moments")
    - Evidências literais que sustentam os temas (campo "evidence")

    NÃO assuma que todos esses elementos existem.
    Use apenas os que estiverem presentes no contexto fornecido pelo treatment_result.
    
    O treatment_result indica o diretório onde os arquivos JSON tratados estão armazenados.
    Cada arquivo JSON contém:
    - cleaned_text: texto limpo da entrevista
    - semantics: objeto com themes, sentiments, moments, brand_mentions, evidence
    - uuid: identificador único da entrevista

    ─────────────────────────────────────────
    ESTRUTURA DO RELATÓRIO (CONDICIONAL)
    ─────────────────────────────────────────

    ⚠️ Uma seção SÓ deve conter análise se houver dados.
    Caso contrário, declarar ausência de evidência.

    1. Resumo Executivo
       - Responda à pergunta "{topic}"
       - Use apenas achados explicitamente presentes
       - Cite quantas entrevistas sustentam cada ponto

    2. Metodologia
       - Número real de entrevistas realizadas
       - Período real das entrevistas (se disponível)
       - Abordagem qualitativa Consumer Hours
       - Se algum dado não estiver disponível, declarar explicitamente

    3. Temas Identificados nas Entrevistas
       - Liste apenas temas realmente presentes no treatment_result
       - Para cada tema:
         • Quantas entrevistas mencionaram (baseado nos dados agregados)
         • Citações literais EXATAS do campo "evidence" que sustentam o tema
       - Use as citações literais do campo "evidence", não invente citações

    4. Análise de Sentimento
       - Use apenas sentimentos identificados nos dados do treatment_result
       - Para cada sentimento, use as evidências literais do campo "evidence"
       - Explique o sentimento usando citações literais EXATAS dos entrevistados
       - Se não houver dados suficientes, declarar limitação

    5. Marcas e Momentos de Consumo
       - Liste TODAS as marcas mencionadas usando seus NOMES REAIS (ex: Brahma, Heineken, Skol)
       - NUNCA use nomes genéricos como "Marca A" ou "Marca B"
       - Para cada marca, indique:
         • Quantas entrevistas mencionaram a marca
         • Citações literais do campo "evidence" que mencionam a marca
       - Liste os momentos de consumo mencionados com citações literais
       - Se nenhuma marca ou momento for mencionado, declarar ausência

    6. Padrões ou Agrupamentos de Opinião
       - Só incluir se houver repetição clara de posicionamentos
       - Caso contrário, declarar que não foi possível identificar padrões

    7. Insights Estratégicos
       - Derivar SOMENTE do que os consumidores disseram explicitamente
       - NÃO extrapolar implicações além das falas

    8. Citações Representativas
       - Listar apenas citações literais do campo "evidence" presente nos dados tratados
       - Use EXATAMENTE o texto presente no campo "evidence" de cada entrevista
       - Não adaptar, resumir ou reescrever as citações
       - Se possível, indique qual marca ou tema está relacionado à citação
       - Ordene por relevância para o tema do relatório

    9. Recomendações
       - Só podem existir se houver falas que indiquem expectativas,
         frustrações ou desejos claros dos consumidores
       - Caso contrário, declarar que os dados não permitem recomendações

    10. Limitações e Próximos Passos
        - Explicitar lacunas reais dos dados
        - Indicar apenas aprofundamentos coerentes com o que faltou nas entrevistas

    ─────────────────────────────────────────
    PROIBIÇÕES ABSOLUTAS
    ─────────────────────────────────────────

    ❌ Inventar dados, percentuais ou padrões
    ❌ Inferir comportamento não verbalizado
    ❌ Completar seções por "boa prática"
    ❌ Usar conhecimento geral de mercado
    ❌ Parafrasear citações
    ❌ Criar exemplos hipotéticos

    Se houver qualquer dúvida sobre a existência de um dado:
    NÃO ESCREVA.
    DECLARE A AUSÊNCIA.
  expected_output: >
    Relatório executivo em Markdown limpo, baseado EXCLUSIVAMENTE
    no conteúdo presente nas entrevistas Consumer Hours fornecidas.
    Todas as afirmações devem conter evidência literal ou declaração
    explícita de ausência de dados.
    O relatorio nao deve ter vestigios de markdown alem do relatório.
