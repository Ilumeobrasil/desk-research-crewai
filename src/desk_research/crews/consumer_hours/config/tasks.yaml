ingest:
  description: >
    Leia os arquivos .docx em {ingest_input_dir} (recursivo), extraia o texto integral e escreva
    arquivos .json em {ingest_output_dir}. Use a ferramenta ingest_folder_tool com:

    - input_dir: {ingest_input_dir}
    - output_dir: {ingest_output_dir}
    - upload_to_asimov: {upload_to_asimov} (DEVE ser true)
    - snippet_chunk_chars: {snippet_chunk_chars}
    - max_snippets_per_request: {max_snippets_per_request}

    Retorne um resumo com contagem de arquivos processados e avisos.
  expected_output: >
    Um resumo textual contendo:
    - input_dir e output_dir efetivos
    - quantidade de docx lidos
    - quantidade de json escritos
    - status do upload Asimov (ok/erro, contagem, dataset)
    - lista curta de avisos (se houver)
  agent: ingestor

treat:
  description: >
    Execute o Agente 2 (Treatment) sobre os JSONs gerados pelo Agente 1 (ingestor).

    Leia os arquivos .json em {treat_input_dir} (onde o ingestor escreveu os JSONs) 
    e escreva a saída tratada em {treat_output_dir}. Use a ferramenta treat_folder com:

    - input_dir: {treat_input_dir}
    - output_dir: {treat_output_dir}
    - enable_rag: {enable_rag} (DEVE ser true)
    - poll_attempts: {poll_attempts}
    - poll_sleep_s: {poll_sleep_s}
    - temperature: {temperature}
    - max_tokens: {max_tokens}

    ─────────────────────────────────────────
    LIMPEZA E NORMALIZAÇÃO DO TEXTO
    ─────────────────────────────────────────

    O texto extraído dos documentos pode conter artefatos e ruído. Você DEVE aplicar
    uma limpeza rigorosa antes de processar:

    1. **Remoção de Artefatos de Formatação**:
       - Remover caracteres de controle invisíveis (tabs, quebras de linha excessivas)
       - Normalizar espaços múltiplos para espaço único
       - Remover formatação markdown residual (**texto**, *texto*, `código`)
       - Normalizar aspas inteligentes (" " → " ")
       - Normalizar traços especiais (- — → -)
       - Remover caracteres especiais quebrados (�, ? em sequências)

    2. **Remoção de Conteúdo Não-Informativo**:
       - Remover cabeçalhos e rodapés repetitivos de documentos
       - Remover metadados de arquivo (nomes de arquivo, caminhos, timestamps)
       - Remover instruções de formatação ou templates visíveis
       - Remover linhas vazias excessivas (manter no máximo 2 linhas consecutivas)
       - Remover pontuação repetida excessiva (!!! → !, ??? → ?)

    3. **Normalização de Estrutura**:
       - Manter apenas o conteúdo textual relevante das entrevistas
       - Preservar diálogos e falas dos entrevistados
       - Remover identificadores técnicos ou códigos internos quando não informativos
       - Normalizar variações de escrita (ex.: "não" vs "não" com acento)

    4. **Foco em Pontos Importantes**:
       - Priorizar declarações diretas dos consumidores sobre comportamentos, opiniões e sentimentos
       - Manter contexto suficiente para entender o significado das falas
       - Remover redundâncias e repetições desnecessárias
       - Preservar evidências literais que sustentam insights

    ─────────────────────────────────────────
    EXTRAÇÃO DE SEMÂNTICA VIA RAG
    ─────────────────────────────────────────

    Após a limpeza, consulte o Asimov RAG para extrair semântica estruturada:

    - **language**: Identifique o idioma do texto (código ISO, ex.: "pt")
    - **brand_mentions**: Liste marcas mencionadas explicitamente (normalizadas, sem duplicatas)
    - **themes**: Extraia temas principais discutidos (focos em insights de consumo, comportamentos, preferências)
    - **sentiments**: Identifique sentimentos expressos (positivo, neutro, negativo, ambivalente)
    - **moments**: Capture momentos/ocasiões de consumo mencionados
    - **evidence**: Selecione 2-5 evidências literais mais relevantes do texto limpo que sustentam os temas identificados

    ⚠️ IMPORTANTE: As evidências devem ser trechos EXATOS do texto limpo, não paráfrases.
    Priorize evidências que sejam:
    - Declarações diretas dos consumidores
    - Exemplos concretos de comportamento ou opinião
    - Citações que ilustram sentimentos ou temas identificados

  expected_output: >
    Após processar os arquivos com a ferramenta treat_folder, você DEVE fornecer um resumo
    estruturado que será usado pela task write_report. O resumo DEVE incluir:
    
    1. Resumo estatístico do processamento (já fornecido pela ferramenta):
       - Número de arquivos processados
       - Número de arquivos com sucesso/erro
       - Status do RAG
    
    2. Resumo dos dados tratados (CRÍTICO para o relatório):
       Após a ferramenta treat_folder processar os arquivos, você DEVE ler os arquivos JSON tratados
       no diretório {treat_output_dir} e consolidar os seguintes dados:
       
       - Lista de TODAS as marcas mencionadas com seus NOMES REAIS (ex: Brahma, Heineken, Skol, Stella Artois)
         e quantas entrevistas mencionaram cada marca
       
       - Lista de TODOS os temas identificados e quantas entrevistas mencionaram cada tema
       
       - Lista de TODOS os sentimentos encontrados e sua distribuição
       
       - Lista de TODOS os momentos de consumo mencionados
       
       - Lista das evidências mais importantes (citações literais do campo "evidence")
         organizadas por tema ou marca quando aplicável
       
       - Resumos executivos de cada entrevista (campo "resumo" do JSON tratado)
         que contêm sínteses dos principais insights de cada entrevista
       
       - Número total de entrevistas processadas com sucesso
       
       FORMATO DO RESUMO:
       Apresente os dados consolidados de forma estruturada, listando explicitamente:
       - Nomes reais das marcas (nunca use genéricos)
       - Citações literais exatas do campo "evidence"
       - Resumos executivos das entrevistas (campo "resumo")
       - Contagens de menções por tema/marca/sentimento
       
       IMPORTANTE: O resumo dos dados tratados é essencial porque será a única fonte de informação
       disponível para a task write_report. Sem esse resumo detalhado com nomes reais de marcas
       e citações literais, o relatório não poderá ser gerado corretamente.
  agent: treater

write_report:
  description: >
    Criar um RELATÓRIO EXECUTIVO COMPLETO E DENSO
    (profundo, analítico e responsável) sobre o tema:

    "{topic}"

    utilizando EXCLUSIVAMENTE os dados presentes nas entrevistas Consumer Hours.

    Este relatório NÃO é exploratório nem opinativo.
    Seu objetivo é traduzir evidência qualitativa
    em INSIGHTS EXECUTIVOS CLAROS,
    respeitando estritamente os limites dos dados.

    ─────────────────────────────────────────
    MODO DE OPERAÇÃO OBRIGATÓRIO
    ─────────────────────────────────────────

    ⚠️ CONTEXT-BOUND ESTRITO ⚠️

    É ESTRITAMENTE PROIBIDO:
    - Utilizar conhecimento externo
    - Fazer benchmarking
    - Generalizar para o mercado
    - Inferir causas, motivações ou impactos
      que não estejam verbalizados
    - Preencher lacunas com suposições

    Tudo o que for escrito DEVE estar ancorado
    em evidência das entrevistas.

    ─────────────────────────────────────────
    PRINCÍPIO CENTRAL
    ─────────────────────────────────────────

    Este relatório DEVE:

    - Diferenciar claramente:
      • O que os entrevistados AFIRMAM
      • O que aparece como PADRÃO recorrente
      • O que NÃO pode ser afirmado
    - Declarar explicitamente insuficiência de dados
      sempre que aplicável
    - Evitar qualquer extrapolação estratégica
      não verbalizada pelos consumidores

    Insight, neste contexto, significa:
    "Síntese fiel de padrões, recorrências ou contrastes
     observáveis nas entrevistas,
     SEM adicionar explicações externas."

    ─────────────────────────────────────────
    REGRAS DE EVIDÊNCIA (INVIOLÁVEIS)
    ─────────────────────────────────────────

    Nenhuma afirmação pode existir sem evidência.

    Para QUALQUER insight, tendência ou padrão,
    É OBRIGATÓRIO informar:

    1. Número de entrevistas envolvidas
    2. Pelo menos uma citação literal EXATA
       retirada do campo "evidence"

    Se qualquer um desses elementos faltar:
    ➜ NÃO ESCREVA O INSIGHT
    ➜ DECLARE A AUSÊNCIA DE EVIDÊNCIA

    ─────────────────────────────────────────
    FONTE ÚNICA DE DADOS
    ─────────────────────────────────────────

    Use EXCLUSIVAMENTE os dados disponíveis
    no treatment_result e nos arquivos JSON tratados.

    Campos que PODEM existir (não assumir todos):
    - cleaned_text
    - resumo
    - themes
    - sentiments
    - brand_mentions (usar SEMPRE nomes reais)
    - moments
    - evidence

    Se um campo não estiver presente,
    declare explicitamente sua ausência no relatório.

    ─────────────────────────────────────────
    DIRETRIZES DE ESCRITA
    ─────────────────────────────────────────

    1. O relatório deve ser escrito em português (PT-BR)
    2. Linguagem executiva, clara e precisa
    3. Texto corrido e analítico (evitar listas soltas)
    4. Cada seção deve conter múltiplos parágrafos
       substanciais, quando os dados permitirem
    5. Nunca “forçar densidade” se os dados não sustentarem

    Densidade aqui significa profundidade analítica,
    não volume artificial de texto.

    ─────────────────────────────────────────
    ESTRUTURA OBRIGATÓRIA DO RELATÓRIO
    ─────────────────────────────────────────

    1. Título e Data
       - Título relacionado diretamente ao tema "{topic}"
       - Data do relatório: {date}

    2. Resumo Executivo
       - Responder diretamente ao tema
       - Sintetizar apenas padrões explícitos
       - Indicar quantas entrevistas sustentam cada ponto
       - Declarar claramente limites dos dados
       - Incluir trechos reais das entrevistas como evidência, utilizando texto exato das transcrições.
       - Resumo deve ser claro e possuir múltiplos parágrafos, quando os dados permitirem.

    3. Introdução e Contexto da Pesquisa
       - Objetivo das entrevistas
       - Abordagem Consumer Hours
       - O que este relatório PODE e NÃO PODE afirmar

    4. Metodologia
       - Número real de entrevistas
       - Período (se disponível)
       - Estrutura dos dados analisados
       - Ausências relevantes de informação

    5. Principais Descobertas das Entrevistas
       - Padrões recorrentes explicitamente observados
       - Sempre com:
         • Número de entrevistas
         • Evidência literal exata - sempre incluir trechos reais das entrevistas como evidência, utilizando texto exato das transcrições.

    6. Análise Detalhada dos Padrões
       - Aprofundamento nos contrastes e recorrências
       - Comparação entre posicionamentos explícitos
       - Nenhuma explicação causal não verbalizada

    7. Temas, Sentimentos, Marcas e Momentos
       - Apenas elementos explicitamente identificados
       - Volume de menções
       - Evidências associadas - sempre incluir trechos reais das entrevistas como evidência, utilizando texto exato das transcrições.

    8. Limitações dos Dados
       - Onde os dados NÃO permitem conclusão
       - Onde há baixa recorrência
       - Onde há ausência de evidência

    9. Oportunidades ou Tensões Explicitadas
       - Apenas quando verbalizadas claramente
       - Nunca extrapolar implicações estratégicas

    ─────────────────────────────────────────
    FRASE DE SEGURANÇA (OBRIGATÓRIA)
    ─────────────────────────────────────────

    Sempre que houver dúvida sobre a existência
    de um padrão ou insight:
    NÃO ESCREVA.
    DECLARE A AUSÊNCIA DE EVIDÊNCIA.
  expected_output: >
    Relatório executivo em Markdown contendo:
    - Título e Data
    - Resumo Executivo
    - Introdução e Contexto da Pesquisa
    - Metodologia
    - Principais Descobertas das Entrevistas
    - Análise Detalhada dos Padrões
    - Temas, Sentimentos, Marcas e Momentos
    - Limitações dos Dados
    - Oportunidades ou Tensões explicitadas

    O relatório deve ser denso, responsável,
    analítico e baseado EXCLUSIVAMENTE
    nas falas explícitas dos entrevistados.
  agent: writer